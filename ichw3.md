# ichw3

# 通用的高速缓存存储器(Cache)的结构及工作原理

### Cache简介：

·高速缓冲存储器(Cache)是存在于主存与CPU之间的一级存储器，由静态存储芯片(SRAM)组成，容量比较小但速度比主存高得多，接近于CPU的速度。计算机中，在速度方面，主存和CPU有大约一个数量级的差距。这个差距限制了CPU速度潜力的发挥。为了弥合这个差距，仅采用一种工艺的单一存储器是行不通的，必须进一步从计算机系统结构和组织上去研究。设置高速缓冲存储器（Cache）是解决存取速度的重要方法。

## 结构：

Cache主要由三部分组成：

Cache存储体：存放由主存调入的指令与数据块。

地址转换部件：建立目录表以实现主存地址到缓存地址的转换。

替换部件：在缓存已满时按一定策略进行数据块替换，并修改地址转换部件。

Cache和主存的结构基本相同，均含有数据及地址，但Cache中还有一项“地址信息”，即上述地址转换部件，用来存储该数据对应物理内存的地址。因此当CPU访问Cache时同时还可以得到该数据在主存中的地址，从而得到物理内存中的相应数据。因此CPU可以直接从Cache中读取正确数据并进行处理从而加快速度。

## 工作原理

首先，为了弄清楚Cache的工作原理，我们需要明白Cache是如何与主存的数据联系起来的。缓存和主存数据一一对应（映射）的方式主要有3种：

### ① 全相联映射

地址映象规则：主存的任意一块可以映象到Cache中的任意一块        

(1)主存与缓存分成相同大小的数据块。      (2)主存的某一数据块可以装入缓存的任意一块空间中。        

全相联方式的对应关系如下图所示。

![image text](https://github.com/TimGinobili/ichw/blob/master/1.jpg)

可知，如果Cache的块数为C，主存的块数为M，则映象关系共有C×M种。

在全相联Cache中，存储的块与块之间，以及存储顺序或保存的存储器地址之间没有直接的关系。程序可以访问很多的子程序、堆栈和段，而它们是位于主存储器的不同部位上。因此，Cache保存着很多互不相关的数据块，Cache必须对每个块和块自身的地址加以存储。当请求数据时，Cache控制器要把请求地址同所有地址加以比较，进行确认。 
这种Cache结构的主要优点是，它能够在给定的时间内去存储主存器中的不同的块，命中率高；缺点是每一次请求数据同Cache中的地址进行比较需要相当的时间，速度较慢，成本高，因而应用少。

### ② 直接映射

地址映象规则：主存储器中一块只能映象到Cache的一个特定的块中。        

(1)主存与缓存分成相同大小的数据块。        (2)主存容量应是缓存容量的整数倍，将主存空间按缓存的容量分成区 ，主存中每一区的块数与缓存的总块数相等。        (3) 主存中某区的一块存入缓存时只能存入缓存中块号相同的位置。

直接相联映象规则如下图。

![image text]()
